<!DOCTYPE html>
<html>
<body>

<canvas id="myCanvas" width="900" height="900" style="border:1px solid #d3d3d3;">
Your browser does not support the HTML canvas tag.</canvas>

<script>
var c = document.getElementById("myCanvas");
var CTX = c.getContext("2d");

let ORGX = 300;
let ORGY = 300;
let WIDTH = c.offsetWidth;
let HEIGHT = c.offsetHeight;
let THETA = Math.PI/8;
let PHI = Math.PI/8;
let HORIZON = 500;

DrawGrid(0,0,500);

Arrow(0,0,0,100,100,100,'red',3);
Node(0,0,0,10);
Node(100,100,100,10);

// *************************************************

function DrawGrid(x,z,length)
{
for (let xi = x; xi <= x + length; xi += 50) 
   {
   SST_Line(xi,0,0,xi,0,length,'lightgrey');
   }

for (let zi = z; zi <= z + length; zi += 50) 
   {
   SST_Line(0,0,zi,length,0,zi,'lightgrey');
   }

SST_Line(-length/2,0,0,0,0,0,'lightgrey');
SST_Line(0,0,-length/2,0,0,0,'lightgrey');
SST_Line(0,-length/2,0,0,length,0,'lightgrey');
}

// *************************************************

function SST_Line(x0,y0,z0,xp,yp,zp,colour)
{
CTX.beginPath();
let xb = Tx(x0,y0,z0);
let yb = Ty(x0,y0,z0);
let xe = Tx(xp,yp,zp);
let ye = Ty(xp,yp,zp);

CTX.moveTo(xb,yb);
CTX.lineTo(xe,ye);
CTX.strokeStyle = colour;
CTX.stroke();
CTX.closePath();
}

// *************************************************

function Tx(x,y,z) 
{
let scale = HORIZON / (HORIZON + z)

let xt = ORGX + scale * (x * Math.cos(THETA) + z * Math.cos(PHI));
return xt;
}

// *************************************************

function Ty(x,y,z) 
{
let scale = HORIZON / (HORIZON + z)
let yt = HEIGHT - ORGY - scale * (y + z * Math.sin(PHI) - x * Math.sin(THETA));
return yt;
}

// *************************************************

function Node(x,y,z,r)
{
CTX.beginPath();

let x0 = Tx(x,y,z);
let y0 = Ty(x,y,z);
let scale = HORIZON / (HORIZON + z)
r = r * scale;

const grad = CTX.createLinearGradient(x0,y0,x0+r,y0+r);
grad.addColorStop(0, "lightblue");
grad.addColorStop(1, "darkblue");

CTX.arc(x0, y0, r, 0, Math.PI*2);
CTX.fillStyle = grad;
CTX.fill();
CTX.closePath();
}

// *************************************************

function Arrow(x0,y0,z0,xp,yp,zp,colour,thickness)
{
SST_Line(x0,y0,z0,xp,yp,zp,colour);

let frx = Tx(x0,y0,z0);
let fry = Ty(x0,y0,z0);
let tox = Tx(xp,yp,zp);
let toy = Ty(xp,yp,zp);
let scale = HORIZON / (HORIZON + zp)
let angle = Math.atan2(toy-fry,tox-frx);
let headangle = Math.PI/12;
let headlen = 20 * scale;
let noderadius = 10 * scale;

CTX.beginPath();
CTX.strokeStyle = colour;
CTX.lineWidth = thickness;

CTX.moveTo(tox-noderadius*Math.cos(angle),toy-noderadius*Math.sin(angle));
CTX.lineTo(tox-headlen*Math.cos(angle-headangle),toy-headlen*Math.sin(angle-headangle));
CTX.moveTo(tox-noderadius*Math.cos(angle),toy-noderadius*Math.sin(angle));
CTX.lineTo(tox-headlen*Math.cos(angle+headangle),toy-headlen*Math.sin(angle+headangle));
CTX.stroke();
CTX.closePath();
}

// *************************************************
</script>

</body>
</html>

