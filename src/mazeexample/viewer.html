<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Maze Solver - Visual Path</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            animation: {
              "pulse-slow": "pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite",
              glow: "glow 2s ease-in-out infinite alternate",
            },
            keyframes: {
              glow: {
                "0%": { boxShadow: "0 0 5px rgba(34, 197, 94, 0.5)" },
                "100%": {
                  boxShadow:
                    "0 0 20px rgba(34, 197, 94, 1), 0 0 30px rgba(34, 197, 94, 0.7)",
                },
              },
            },
          },
        },
      };
    </script>
    <style>
      .cell {
        aspect-ratio: 1;
        transition: all 0.5s ease;
      }
      .path-cell {
        background: linear-gradient(135deg, #22c55e 0%, #10b981 100%);
        animation: fadeIn 1.2s ease-in-out;
      }
      .start-cell {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        animation: pulse 3s ease-in-out infinite;
      }
      .end-cell {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        animation: glow 3s ease-in-out infinite alternate;
      }
      @keyframes fadeIn {
        0% {
          opacity: 0;
          transform: scale(0.5) rotate(-5deg);
        }
        50% {
          transform: scale(1.1) rotate(2deg);
        }
        100% {
          opacity: 1;
          transform: scale(1) rotate(0deg);
        }
      }
      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.15);
          opacity: 0.85;
        }
      }
      .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        transition: transform 0.3s ease;
      }
      .stat-card:hover {
        transform: translateY(-5px) scale(1.02);
      }
      .animate-slide-in {
        animation: slideIn 0.8s ease-out;
      }
      @keyframes slideIn {
        from {
          transform: translateY(30px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }
    </style>
  </head>
  <body
    class="bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 min-h-screen text-white">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
      <!-- Header -->
      <div class="text-center mb-8 animate-slide-in">
        <h1
          class="text-5xl font-bold mb-3 bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">
          üß© Maze Solver
        </h1>
        <p class="text-gray-300 text-lg">Bidirectional Wavefront Search Visualization</p>
      </div>

      <!-- Load Section -->
      <div id="loadSection" class="max-w-2xl mx-auto">
        <div
          class="bg-gray-800/50 backdrop-blur-sm rounded-2xl p-8 border border-gray-700 shadow-2xl">
          <h2 class="text-2xl font-bold mb-4 text-center">Load Maze Results</h2>
          <p class="text-gray-300 text-center mb-6">
            Generate with:
            <code class="bg-gray-900 px-3 py-1 rounded text-green-400">task serve</code>
          </p>

          <div class="bg-yellow-500/10 border border-yellow-500/30 rounded-xl p-4 mb-6">
            <p class="text-yellow-200 text-sm font-medium mb-2">üí° Best Experience:</p>
            <pre
              class="bg-gray-900/50 px-3 py-2 rounded text-xs text-gray-300 overflow-x-auto">
task serve</pre
            >
            <p class="text-yellow-200/80 text-xs mt-2">
              Then open:
              <span class="text-blue-400">http://localhost:8000/viewer.html</span>
            </p>
          </div>

          <label for="fileInput" class="block">
            <div
              class="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 cursor-pointer rounded-xl p-4 text-center font-semibold transition-all transform hover:scale-105 shadow-lg">
              üìÇ Load JSON File
            </div>
          </label>
          <input type="file" id="fileInput" class="hidden" accept=".json" />
        </div>
      </div>

      <!-- Results Section -->
      <div id="resultsSection" class="hidden">
        <!-- Stats Grid -->
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8" id="statsGrid"></div>

        <!-- Solution Picker -->
        <div id="solutionPicker" class="mb-8 flex justify-center gap-4"></div>

        <!-- Main Content Grid -->
        <div class="grid lg:grid-cols-2 gap-8">
          <!-- Maze Visualization -->
          <div
            class="bg-gray-800/50 backdrop-blur-sm rounded-2xl p-6 border border-gray-700 shadow-2xl">
            <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
              üó∫Ô∏è Maze Grid
              <span class="text-sm font-normal text-gray-400" id="mazeInfo"></span>
            </h2>
            <div id="mazeGrid" class="bg-gray-900/50 p-4 rounded-xl"></div>

            <!-- Legend -->
            <div class="mt-6 flex flex-wrap gap-4 text-sm">
              <div class="flex items-center gap-2">
                <div
                  class="w-6 h-6 rounded bg-gradient-to-br from-blue-500 to-blue-600"></div>
                <span>Start</span>
              </div>
              <div class="flex items-center gap-2">
                <div
                  class="w-6 h-6 rounded bg-gradient-to-br from-red-500 to-red-600"></div>
                <span>Exit</span>
              </div>
              <div class="flex items-center gap-2">
                <div
                  class="w-6 h-6 rounded bg-gradient-to-br from-green-500 to-green-600"></div>
                <span>Solution Path</span>
              </div>
              <div class="flex items-center gap-2">
                <div class="w-6 h-6 rounded bg-gray-700"></div>
                <span>Corridor</span>
              </div>
              <div class="flex items-center gap-2">
                <div class="w-6 h-6 rounded bg-gray-950 border border-gray-800"></div>
                <span>Wall</span>
              </div>
            </div>
          </div>

          <!-- Timeline -->
          <div
            class="bg-gray-800/50 backdrop-blur-sm rounded-2xl p-6 border border-gray-700 shadow-2xl">
            <h2 class="text-2xl font-bold mb-4">üìä Search Progress</h2>
            <div
              class="bg-gray-900/50 rounded-xl p-4 max-h-[600px] overflow-y-auto"
              id="searchTimeline"></div>
          </div>
        </div>

        <!-- Solution Details -->
        <div
          class="mt-8 bg-gray-800/50 backdrop-blur-sm rounded-2xl p-6 border border-gray-700 shadow-2xl"
          id="solutionDetails">
          <h2 class="text-2xl font-bold mb-4">‚ú® Solution Details</h2>
          <div id="solutionsContainer"></div>
        </div>
      </div>
    </div>

    <script>
      // Auto-load functionality
      async function tryAutoLoad() {
        try {
          const response = await fetch("results.json");
          if (response.ok) {
            const data = await response.json();
            displayResults(data);
            return true;
          }
        } catch (error) {
          console.log("Could not auto-load results.json:", error.message);
        }
        return false;
      }

      window.addEventListener("DOMContentLoaded", async () => {
        await tryAutoLoad();
      });

      document.getElementById("fileInput").addEventListener("change", function (e) {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (event) {
          try {
            const data = JSON.parse(event.target.result);
            displayResults(data);
          } catch (error) {
            alert("Error parsing JSON: " + error.message);
          }
        };
        reader.readAsText(file);
      });

      function parseNodeCoords(nodeName) {
        // Parse "b2" -> {row: 1, col: 1}
        // Format: letter=row (a-i = rows 0-8), number=column (1-9 = cols 0-8)
        // Also supports old "maze_b2" format for backwards compatibility
        const match = nodeName.match(/(?:maze_)?([a-i])(\d)/);
        if (!match) return null;
        const row = match[1].charCodeAt(0) - "a".charCodeAt(0); // Letter ‚Üí row
        const col = parseInt(match[2]) - 1; // Number ‚Üí col
        return { row, col };
      }

      function buildWalkableSet(data) {
        // Build set of all walkable cells from ALL paths in the maze
        // Walls are cells that are NOT in this set
        const walkable = new Set();

        // Add all nodes from all solutions
        data.solutions.forEach((solution) => {
          solution.path.forEach((link) => {
            walkable.add(link.from);
            walkable.add(link.to);
          });
        });

        // Add start and end
        walkable.add(data.start_node);
        walkable.add(data.end_node);

        return walkable;
      }

      function createMazeGrid(data) {
        const solution = data.solutions[0];
        if (!solution) return;

        // Build walkable cells (not walls)
        const walkable = buildWalkableSet(data);

        // Build solution path
        const pathNodes = new Set();
        const startCoords = parseNodeCoords(data.start_node);
        const endCoords = parseNodeCoords(data.end_node);

        pathNodes.add(data.start_node);
        solution.path.forEach((link) => {
          pathNodes.add(link.from);
          pathNodes.add(link.to);
        });

        // Create 9x9 grid
        const grid = document.getElementById("mazeGrid");
        grid.className = "grid grid-cols-9 gap-1 bg-gray-900/50 p-4 rounded-xl";
        grid.innerHTML = "";

        for (let row = 0; row < 9; row++) {
          for (let col = 0; col < 9; col++) {
            // Generate node name: letter=row, number=column (e.g., "b2")
            const nodeName = `${String.fromCharCode("a".charCodeAt(0) + row)}${col + 1}`;
            const cell = document.createElement("div");
            cell.className = "cell rounded shadow-lg";

            const isWalkable = walkable.has(nodeName);

            if (nodeName === data.start_node) {
              cell.className += " start-cell";
              cell.innerHTML =
                '<div class="w-full h-full flex items-center justify-center text-2xl">üöÄ</div>';
            } else if (nodeName === data.end_node) {
              cell.className += " end-cell";
              cell.innerHTML =
                '<div class="w-full h-full flex items-center justify-center text-2xl">üéØ</div>';
            } else if (pathNodes.has(nodeName)) {
              cell.className += " path-cell";
              // Slower, more varied animation delays for playful effect
              cell.style.animationDelay = `${Math.random() * 1.5}s`;
            } else if (isWalkable) {
              // Walkable corridor but not on solution path
              cell.className += " bg-gray-700/50 hover:bg-gray-600/50";
            } else {
              // WALL - not walkable!
              cell.className += " bg-gray-950 border border-gray-800/50";
              cell.innerHTML =
                '<div class="w-full h-full opacity-20 flex items-center justify-center">‚ñì</div>';
            }

            cell.title = nodeName;
            grid.appendChild(cell);
          }
        }

        document.getElementById("mazeInfo").textContent = `${String.fromCharCode(
          "A".charCodeAt(0) + startCoords.col
        )}${startCoords.row + 1} ‚Üí ${String.fromCharCode(
          "A".charCodeAt(0) + endCoords.col
        )}${endCoords.row + 1}`;
      }

      function displayResults(data) {
        document.getElementById("loadSection").classList.add("hidden");
        document.getElementById("resultsSection").classList.remove("hidden");

        // Store data globally for solution switching
        window.mazeData = data;
        window.currentSolution = 0;

        // Solution Picker (if multiple solutions)
        const picker = document.getElementById("solutionPicker");
        if (data.solutions.length > 1) {
          picker.innerHTML = data.solutions
            .map(
              (sol, idx) => `
            <button 
              onclick="switchSolution(${idx})"
              id="solBtn${idx}"
              class="px-6 py-3 rounded-xl font-semibold transition-all transform hover:scale-105 ${
                idx === 0
                  ? "bg-gradient-to-r from-green-600 to-emerald-600 text-white shadow-lg"
                  : "bg-gray-700 text-gray-300 hover:bg-gray-600"
              }">
              üõ§Ô∏è Path ${idx + 1} (${sol.total_length} steps)
            </button>
          `
            )
            .join("");
        }

        // Stats
        const statsGrid = document.getElementById("statsGrid");
        const currentSol = data.solutions[window.currentSolution];
        statsGrid.innerHTML = `
                <div class="stat-card rounded-xl p-4 text-center shadow-lg">
                    <div class="text-3xl font-bold">${
                      data.statistics.total_solutions
                    }</div>
                    <div class="text-xs text-gray-200 mt-1">Solutions Found</div>
                </div>
                <div class="stat-card rounded-xl p-4 text-center shadow-lg">
                    <div class="text-3xl font-bold">${currentSol?.total_length || 0}</div>
                    <div class="text-xs text-gray-200 mt-1">Current Path</div>
                </div>
                <div class="stat-card rounded-xl p-4 text-center shadow-lg">
                    <div class="text-3xl font-bold">${
                      data.statistics.max_left_depth
                    }</div>
                    <div class="text-xs text-gray-200 mt-1">Left Depth</div>
                </div>
                <div class="stat-card rounded-xl p-4 text-center shadow-lg">
                    <div class="text-3xl font-bold">${
                      data.statistics.max_right_depth
                    }</div>
                    <div class="text-xs text-gray-200 mt-1">Right Depth</div>
                </div>
                <div class="stat-card rounded-xl p-4 text-center shadow-lg">
                    <div class="text-3xl font-bold">${
                      data.statistics.total_search_steps
                    }</div>
                    <div class="text-xs text-gray-200 mt-1">Search Steps</div>
                </div>
            `;

        // Maze Grid
        createMazeGrid(data);

        // Timeline
        const timeline = document.getElementById("searchTimeline");
        timeline.innerHTML = data.search_steps
          .slice(0, 20)
          .map(
            (step) => `
                <div class="mb-3 p-3 rounded-lg ${
                  step.solutions_found > 0
                    ? "bg-green-500/20 border border-green-500/30"
                    : "bg-gray-800/30"
                } transition-all hover:bg-gray-700/30">
                    <div class="flex justify-between items-center">
                        <span class="font-semibold text-sm">Turn ${step.turn}</span>
                        <span class="text-xs text-gray-400">L:${step.left_depth} ‚¨å R:${
              step.right_depth
            }</span>
                    </div>
                    ${
                      step.solutions_found > 0
                        ? `<div class="text-green-400 text-sm mt-1">‚úì Solution found!</div>`
                        : ""
                    }
                </div>
            `
          )
          .join("");

        // Solution Details
        const solutions = document.getElementById("solutionsContainer");
        if (data.solutions.length > 0) {
          const sol = data.solutions[0];
          solutions.innerHTML = `
                    <div class="bg-gray-900/30 rounded-xl p-4">
                        <div class="flex items-center gap-4 mb-4">
                            <span class="px-3 py-1 bg-green-500/20 text-green-400 rounded-full text-sm font-medium">${sol.type}</span>
                            <span class="text-gray-400">Depths: L:${sol.left_depth} / R:${sol.right_depth}</span>
                        </div>
                        <div class="text-gray-300 text-sm">
                            <p>‚ú® Found efficient path through the maze in ${sol.total_length} steps</p>
                            <p class="mt-2 text-gray-400">Search explored ${data.statistics.total_search_steps} iterations using bidirectional wavefront collision</p>
                        </div>
                    </div>
                `;
        }
      }
    </script>
  </body>
</html>
