#!/bin/bash
# Pre-commit hook to validate template syntax
# Place this in .git/hooks/pre-commit and make it executable

echo "üîç Running template validation..."

cd "$(git rev-parse --show-toplevel)"

# Check if we're in the text2n4l-web directory or a subdirectory
if [[ -f "internal/web/templates_test.go" ]]; then
	# We're in the text2n4l-web directory
	WORKDIR="."
elif [[ -f "text2n4l-web/internal/web/templates_test.go" ]]; then
	# We're in the parent directory
	WORKDIR="text2n4l-web"
else
	echo "‚ö†Ô∏è  Template tests not found, skipping validation"
	exit 0
fi

cd "$WORKDIR"

# Run template tests
if ! make test-templates >/dev/null 2>&1; then
	echo "‚ùå Template validation failed!"
	echo ""
	echo "Run 'make test-templates' to see detailed errors."
	echo "Fix template syntax before committing."
	exit 1
fi

echo "‚úÖ All templates validated successfully"
exit 0
