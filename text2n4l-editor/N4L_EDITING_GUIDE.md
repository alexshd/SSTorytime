# N4L Editing Guide

## Complete Guide to Editing text2n4l Generated Files

This document provides a comprehensive guide for editing N4L (Notes for Learning) files, particularly those generated by the `text2n4l` converter. It covers the workflow, syntax, semantic arrows, validation, and practical editing techniques.

---

## Table of Contents

1. [Overview](#overview)
2. [Arrow Validation](#arrow-validation)
3. [The text2n4l Workflow](#the-text2n4l-workflow)
4. [Understanding Generated Files](#understanding-generated-files)
5. [N4L Syntax Fundamentals](#n4l-syntax-fundamentals)
6. [Semantic Arrow Types](#semantic-arrow-types)
7. [Annotation Markers](#annotation-markers)
8. [Editing Process](#editing-process)
9. [Practical Example: Promise Theory](#practical-example-promise-theory)
10. [Best Practices](#best-practices)
11. [Common Pitfalls](#common-pitfalls)

---

## Overview

N4L (Notes for Learning) is a semi-formal language for creating structured knowledge graphs. The `text2n4l` tool converts plain text documents into N4L format, creating a starting point that you can then edit and refine to build rich semantic relationships.

**Key Concept**: The generated file is a **scaffold** or **skeleton** - you are expected to edit, refine, and enhance it with semantic arrows (relationships) to create a useful knowledge graph.

---

## Arrow Validation

### Visual Error Indicators

The editor now validates arrows against the complete N4L arrow configuration (SSTconfig files). Invalid arrows are displayed with:

- **ðŸ”µ Blue background**: Valid, recognized N4L arrows
- **ðŸ”´ Red background with âš ï¸**: Invalid/unrecognized arrows that will cause parser errors

### How Validation Works

1. **Click on any arrow** (text in parentheses like `(appears close to)`)
2. **If the arrow is invalid**, you'll see:
   - Red highlighting with warning icon
   - Error message explaining the issue
   - Suggested valid alternatives from the arrow menu
3. **Replace with a valid arrow** from the categorized menu

### Why Arrow Validation Matters

The N4L parser (`N4L.go`) validates all arrows against the configuration files:

- `SSTconfig/arrows-NR-0.sst` - Similarity arrows
- `SSTconfig/arrows-LT-1.sst` - Causality arrows
- `SSTconfig/arrows-CN-2.sst` - Composition arrows
- `SSTconfig/arrows-EP-3.sst` - Property arrows

**Using an invalid arrow will cause the parser to fail with error:**

```
ERR_NO_SUCH_ARROW: No such arrow has been declared in the configuration: (your arrow here)
```

### Common Invalid Arrows from text2n4l

The `text2n4l` tool generates natural language relationship text that often needs to be converted:

| Generated Text       | Status     | Replace With                          |
| -------------------- | ---------- | ------------------------------------- |
| `(appears close to)` | âŒ Invalid | `(similar to)` or `(associated with)` |
| `(is similar to)`    | âŒ Invalid | `(similar to)`                        |
| `(relates to)`       | âŒ Invalid | `(associated with)` or `(see also)`   |
| `(mentioned in)`     | âŒ Invalid | `(is discussed in)`                   |
| `(talks about)`      | âŒ Invalid | `(discusses)` or `(is about)`         |

**Pro Tip**: The editor's suggestion feature will automatically recommend valid arrows based on keyword matching!

---

## The text2n4l Workflow

### 1. Convert Plain Text to N4L

```bash
# Convert a plain text file to N4L format
text2n4l ../examples/example_data/promisetheory1.dat

# Output: promisetheory1.dat_edit_me.n4l
```

The tool:

- Extracts sentences from the source text
- Assigns unique identifiers (e.g., `@sen1`, `@sen2`)
- Calculates "intentionality" scores (Running index, Static value)
- Samples sentences based on significance (default 50%)
- Creates initial structure with basic relationships

### 2. Edit the Generated File

Open the `_edit_me.n4l` file in your text editor and:

- Review the automatically extracted sentences
- Add semantic arrows to relate concepts
- Create new nodes for important concepts
- Add annotations and notes
- Refine the structure

### 3. Validate and Upload

```bash
# Validate syntax
N4L promisetheory1.dat_edit_me.n4l

# View verbose output
N4L -v promisetheory1.dat_edit_me.n4l

# Upload to database when ready
N4L -u promisetheory1.dat_edit_me.n4l
```

---

## Understanding Generated Files

### Structure of Generated Files

A typical `_edit_me.n4l` file looks like this:

```n4l
# File: promisetheory1.dat

{Topic}-1-(Running index: 1, Static: 0.5)[1] sentence 0 -> Imagine a simple set of principles...
              " (is in) part 1 of ../examples/example_data/promisetheory1.dat

{Topic}-2-(Running index: 2, Static: 0.7)[2] sentence 1 -> Such principles are the subject of Promise Theory.
              " (is in) part 1 of ../examples/example_data/promisetheory1.dat

{Topic}-3-(Running index: 3, Static: 0.6)[3] sentence 2 -> The goal of Promise Theory is reveal the behaviour...
              " (is in) part 1 of ../examples/example_data/promisetheory1.dat

# Arrows (semantic links) - ADD YOUR OWN HERE
[1] +CONTAINS> [2] [0.85]
[2] +CONTAINS> [3] [0.75]
```

### Components Explained

1. **Node Label**: `{Topic}-1-` - A temporary placeholder
2. **Intentionality Scores**: `(Running index: 1, Static: 0.5)` - Calculated significance
3. **Reference ID**: `[1]` - Used for creating arrows
4. **Sentence Index**: `sentence 0` - Original position in text
5. **Content**: `-> Imagine a simple set of principles...`
6. **Source Link**: `(is in) part 1 of ...` - Tracks provenance

### Sentence Identifiers

The tool generates identifiers like:

- `@sen1`, `@sen2`, `@sen9471` - Unique sentence IDs
- Use these to reference specific sentences in your edits

---

## N4L Syntax Fundamentals

### Basic Node Declaration

```n4l
concept_name (relationship) other_concept
     "       (another_relationship) third_concept
```

The `"` (ditto mark) repeats the subject from the previous line.

### Example

```n4l
Promise Theory (is about) cooperation
      "        (is about) autonomy
      "        (expresses) voluntary intent
      "        (note) Developed by Mark Burgess
```

### Creating Hierarchies

```n4l
-- Main Section Title

  :: Subsection ::

  +:: Special Case or Highlighted Section ::
```

### Comments

```n4l
# This is a comment
// This is also a comment
```

---

## Semantic Arrow Types

N4L uses four primary arrow types based on spacetime causality:

### 0. Similarity (NR - Near Relation)

**Non-directional, symmetric relationships**

```n4l
# arrows-NR-0.sst

promise (similar to) commitment
  "     (associated with) agreement
  "     (see also) contract
  "     (alias) pledge
  "     (equals) voluntary commitment
```

Common markers:

- `(similar to)` `(sim)` - Similar concepts
- `(associated with)` `(ass)` - Loosely coupled
- `(see also)` `(see)` - Related reference
- `(alias)` - Alternative name
- `(equals)` `(=)` - Equivalent
- `(is not)` `(!eq)` - Not the same as
- `(compare)` - Compare with

### 1. Leads To (LT - Causality, Process)

**Directional cause-effect relationships**

```n4l
# arrows-LT-1.sst

promise offer (leads to) promise acceptance
     "        (causes) trust relationship
     "        (results in) cooperation
acceptance (is caused by) offer
    "      (is a result of) voluntary choice
```

Common markers:

- `(leads to)` `(fwd)` â†â†’ `(comes from)` `(bwd)`
- `(causes)` `(cause)` â†â†’ `(is caused by)` `(cause-by)`
- `(creates)` `(cr)` â†â†’ `(is created by)` `(crtd)`
- `(results in)` `(result)` â†â†’ `(was a result of)` `(result-of)`
- `(enables)` â†â†’ `(is enabled by)`
- `(predicts)` â†â†’ `(is predicted by)`
- `(determines)` `(det)` â†â†’ `(is determined by)` `(det-by)`

### 2. Contains (CN - Compositional)

**Part-whole relationships**

```n4l
# arrows-CN-2.sst

Promise Theory (contains) autonomy concept
      "        (contains) voluntary cooperation
      "        (has component) promise
      "        (has component) imposition

promise (is a part of) Promise Theory
   "    (belongs to) cooperation framework
```

Common markers:

- `(contains)` `(contain)` â†â†’ `(belongs to)` `(belong)`
- `(consists of)` â†â†’ `(makes up part of)` `(mkpt)`
- `(has component)` `(has-cmpt)` â†â†’ `(is component of)` `(cmpt-of)`
- `(has a part)` `(has-pt)` â†â†’ `(is a part of)` `(pt-of)`
- `(is a set of)` `(setof)` â†â†’ `(is part of the set)` `(in-set)`

### 3. Expresses/Properties (EP - Attributes)

**Descriptive properties and attributes**

```n4l
# arrows-EP-3.sst

promise (expresses) voluntary intent
   "    (expresses) commitment
   "    (has example) cleaning restroom promise
   "    (note) Always voluntary by definition
   "    (defined as) voluntary offer with optional acceptance

imposition (is about) demands
     "     (describes) non-voluntary requirement
     "     (has condition) may not be accepted
```

Common markers:

- `(expresses)` `(expr)` â†â†’ `(is expressed by)` `(expr-by)`
- `(has example)` `(e.g.)` â†â†’ `(is an example of)` `(ex)`
- `(note)` `(remark)` - Annotation
- `(defined as)` `(def)` â†â†’ `(is the definition of)` `(def-of)`
- `(is about)` `(about)` â†â†’ `(is the topic of)` `(theme-of)`
- `(has attribute)` `(attr)` â†â†’ `(is an attribute of)` `(attr-of)`
- `(has feature)` `(feat)` â†â†’ `(is a feature of)` `(isfeat)`

---

## Annotation Markers

From `SSTconfig/annotations.sst`:

```n4l
% (discusses)      # Body text discusses an annotation
= (involves)       # Body text involves something
** (is a special case of)  # Specialization
>> (is an example of)      # Example relationship
> (has actor/subject role) # Active role
< (has affected object role) # Passive role
```

### Usage Example

```n4l
-- Promise Engineering

  :: Promise of the First Kind ::

  X (offers) promise offer body text unconditionally
  Y (accepts) promise acceptance body text

  promise offer body text (expresses) ham
              "           (expresses) eggs
              "           (has intended promisee) Y
              "           (remark) This is entirely voluntary

  +:: Imposition ::

  accusation (is a special case of) imposition
      "      (expresses) demand without guarantee of acceptance
```

---

## Editing Process

### Step 1: Review Generated Content

1. **Read through all extracted sentences**

   - Check if important concepts were captured
   - Identify missing key sentences
   - Note overly generic or redundant sentences

2. **Understand the automatic structure**
   - The tool creates basic containment relationships
   - Narrative flow is often represented as `+CONTAINS>` arrows
   - These are placeholders - you should refine them

### Step 2: Identify Core Concepts

Extract the main concepts as standalone nodes:

```n4l
promise
imposition
Promise Theory
voluntary cooperation
autonomy
```

### Step 3: Add Semantic Relationships

Replace generic `+CONTAINS>` with specific arrow types:

**Before (Generated)**:

```n4l
[1] +CONTAINS> [2] [0.85]
```

**After (Edited)**:

```n4l
promise (is a part of) Promise Theory
promise (expresses) voluntary intent
promise (has component) offer
promise (has component) acceptance
```

### Step 4: Create Concept Hierarchies

```n4l
-- Promise Theory Main Concepts

  :: Voluntary Interactions ::

  promise (is about) voluntary cooperation
    "     (expresses) autonomy
    "     (has example) first kind promise
    "     (has example) second kind promise

  first kind promise (consists of) unconditional offer
         "           (consists of) optional acceptance
         "           (note) Starts with voluntary offer

  :: Non-Voluntary Interactions ::

  imposition (is about) requirements
      "      (expresses) demands
      "      (note) May lack voluntary acceptance
```

### Step 5: Add Context and Notes

```n4l
promise (note) A promise is entirely voluntary - both offer and acceptance
   "    (remark) Promise Theory distinguishes from impositions
   "    (has example) "I promise the floor will be clean every hour"
   "    (defined as) A voluntary expression of intent by an agent
```

### Step 6: Link Back to Source

Keep or enhance source provenance:

```n4l
@sen42 (is in) part 5 of ../examples/example_data/promisetheory1.dat
  "    (discusses) promise engineering
  "    (mentions) CFEngine as application
```

---

## Practical Example: Promise Theory

### Original Text (from promisetheory1.dat)

```
Promises and Impositions

Imagine a simple set of principles that could help you to understand
how parts combine to become a whole, and how each part sees the whole
from its own perspective.

Such principles are the subject of Promise Theory. The goal of Promise
Theory is reveal the behaviour of a whole from the sum of its parts,
taking the viewpoint of the parts rather than the whole.
```

### Generated N4L (\_edit_me.n4l)

```n4l
{Topic}-1-(Running index: 1, Static: 0.6)[1] sentence 0 -> Imagine a simple set of principles that could help you to understand how parts combine to become a whole
              " (is in) part 1 of ../examples/example_data/promisetheory1.dat

{Topic}-2-(Running index: 2, Static: 0.8)[2] sentence 2 -> Such principles are the subject of Promise Theory
              " (is in) part 1 of ../examples/example_data/promisetheory1.dat

[1] +CONTAINS> [2] [0.85]
```

### Edited N4L (Enhanced)

```n4l
-- Promises and Impositions

  :: Core Concepts ::

Promise Theory (is about) cooperation
      "        (is about) understanding systems
      "        (expresses) bottom-up view
      "        (note) Takes viewpoint of parts not whole
      "        (defined as) Theory revealing whole from sum of parts

cooperation (requires) understanding
     "      (involves) part-whole relationship
     "      (has aspect) individual perspective
     "      (has aspect) collective behaviour

  :: Principles ::

simple principles (leads to) understanding
       "          (enables) systems thinking
       "          (is a part of) Promise Theory
       "          (has example) promise of first kind
       "          (has example) imposition

  :: Promise of the First Kind ::

X (offers) promise offer body text unconditionally
Y (accepts) promise acceptance body text

promise offer body text (expresses) ham
              "         (expresses) eggs
              "         (expresses) cabbage
              "         (has intended promisee) Y
              "         (remark) This is entirely voluntary

promise acceptance body text (expresses) cabbage
              "              (has intended promiser) any

third party (observes) promise offer body text
       "    (observes) promise requirement body text
       "    (may be influenced by) promise offer body text
       "    (may be influenced by) promise acceptance body text

Event: Promise from X to Y accepted (has overlap) cabbage
                   "                (has promiser) X
                   "                (has promisee) Y
                   "                (observed by) third party
                   "                (remark) starts with unconditional offer

  +:: Imposition ::

imposition (is a special case of) interaction
     "     (note) May not be voluntary
     "     (differs from) promise
     "     (has example) accusation

X (imposes) imposing body text
Y (accepts) imposee text

imposing body text (expresses) demand for tariff
          "        (expresses) special offer
          "        (note) A promise with conditions may be an imposition

  +:: Accusation as Special Case ::

accusation (is a special case of) imposition
    "      (has example) your mother was a hamster
    "      (has example) your father smells of elderberries
    "      (has accusee) Y
    "      (note) Without necessary causal effect path if not accepted

# Link to source material
@sen1 (is in) part 1 of ../examples/example_data/promisetheory1.dat
 "    (discusses) Promise Theory
 "    (mentions) cooperation
 "    (mentions) systems thinking
```

---

## Best Practices

### 1. Use Meaningful Node Names

**Bad**:

```n4l
{Topic}-1- (contains) {Topic}-2-
```

**Good**:

```n4l
Promise Theory (contains) promise concept
      "        (contains) imposition concept
```

### 2. Choose Appropriate Arrow Types

Match the semantic relationship:

- Use `(causes)` for causal relationships, not `(contains)`
- Use `(is a part of)` for composition, not `(similar to)`
- Use `(expresses)` for properties, not `(leads to)`

### 3. Add Context Liberally

```n4l
promise (note) Always voluntary by both parties
   "    (remark) Core distinction from imposition
   "    (has example) Cleaning restroom on schedule
   "    (defined as) Voluntary expression of intent
```

### 4. Maintain Source Provenance

```n4l
@sen42 (is in) chapter 3 of source_book.dat
  "    (discusses) main theorem
  "    (page number) 147
```

### 5. Use Hierarchical Sections

```n4l
-- Main Topic

  :: Subtopic ::

  +:: Special Case or Important Detail ::
```

### 6. Keep It Simple

- Start with basic relationships
- Add complexity gradually
- Don't over-engineer on first pass
- Iterate and refine

### 7. Be Consistent

- Use the same arrow abbreviations throughout
- Follow a consistent naming convention
- Group related concepts together

---

## Common Pitfalls

### 1. Using Annotation Markers Incorrectly

**Problem**: Accidentally using markers without spaces

```n4l
cost=$50  # Interpreted as annotation
```

**Solution**: Add spaces or avoid special characters

```n4l
cost (has value) $50
# Or
cost = $50 dollars
```

### 2. Wrong Arrow Direction

**Problem**: Using forward arrow when you mean backward

```n4l
acceptance (leads to) offer  # Wrong causality
```

**Solution**: Think about cause and effect

```n4l
offer (leads to) acceptance  # Correct causality
```

### 3. Overusing Generic Relationships

**Problem**: Everything is `(contains)` or `(similar to)`

```n4l
promise (contains) acceptance  # Too vague
```

**Solution**: Use specific arrow types

```n4l
promise (has component) acceptance
promise (requires) voluntary acceptance
acceptance (is caused by) offer
```

### 4. Neglecting to Edit Generated Content

**Problem**: Leaving placeholder labels and generic arrows

```n4l
{Topic}-1- +CONTAINS> {Topic}-2-
```

**Solution**: Replace with meaningful nodes and relationships

```n4l
promise (is a part of) Promise Theory
   "    (expresses) voluntary intent
```

### 5. Mixing Semantic Levels

**Problem**: Relating a sentence to a concept

```n4l
@sen42 (causes) Promise Theory  # Sentence doesn't cause a theory
```

**Solution**: Extract concepts from sentences

```n4l
@sen42 (discusses) Promise Theory
@sen42 (expresses) cooperation idea

cooperation idea (is a part of) Promise Theory
```

---

## Advanced Techniques

### Creating Cross-References

```n4l
promise in chapter 1 (is same as) promise in chapter 5
         "           (see also) imposition
         "           (compare to) contract
```

### Temporal Relationships

```n4l
promise offer (precedes) promise acceptance
     "        (comes before) trust establishment
acceptance (succeeds) offer
```

### Conditional Logic

```n4l
promise (next if yes) cooperation established
   "    (next if no) negotiation required
```

### Versioning and Evolution

```n4l
Promise Theory v1 (evolved to) Promise Theory v2
         "        (note) Added imposition concepts
         "        (has version) 2004 original
         "        (has version) 2015 expanded
```

---

## Validation and Testing

### Check Syntax

```bash
N4L -v your_file.n4l
```

Look for:

- Missing closing quotes
- Misspelled arrow abbreviations
- Malformed node declarations

### View Summary

```bash
N4L -s your_file.n4l
```

Shows:

- Total nodes
- Total arrows
- Arrow type distribution

### Test Specific Relationships

```bash
N4L -v -s -adj="cause,result" your_file.n4l
```

Filters to show only causality relationships.

---

## Conclusion

Editing N4L files is an iterative process:

1. **Generate** - Use `text2n4l` to create the scaffold
2. **Review** - Read through extracted content
3. **Extract** - Identify core concepts
4. **Relate** - Add semantic arrows
5. **Annotate** - Add notes and context
6. **Validate** - Check syntax and semantics
7. **Refine** - Iterate and improve
8. **Upload** - Load into database when ready

The goal is to transform raw text into a rich semantic network that captures:

- Core concepts and their relationships
- Causal dependencies and processes
- Hierarchical structure
- Context and provenance

With practice, you'll develop an intuition for identifying important relationships and choosing the right arrow types to represent them.

---

## Quick Reference

### Arrow Type Selection Guide

| Relationship       | Arrow Type | Example                       |
| ------------------ | ---------- | ----------------------------- |
| Similar/related    | NR-0       | `(similar to)` `(see also)`   |
| Causes/enables     | LT-1       | `(causes)` `(leads to)`       |
| Part of/contains   | CN-2       | `(is a part of)` `(contains)` |
| Describes/property | EP-3       | `(expresses)` `(note)`        |

### Common Markers Quick List

```
# Similarity (NR-0)
(similar to) (see also) (alias) (associated with)

# Causality (LT-1)
(causes) (leads to) (results in) (enables) (creates)

# Composition (CN-2)
(contains) (is a part of) (consists of) (has component)

# Properties (EP-3)
(expresses) (note) (defined as) (has example) (is about)
```

### File Structure Template

```n4l
-- Main Section

  :: Subsection ::

concept1 (relationship) concept2
   "     (another relationship) concept3
   "     (note) Explanation or context

  +:: Special Case ::

special_concept (is a special case of) concept1
       "        (has example) specific example

# References
@sen1 (is in) source_file.dat
 "    (discusses) concept1
```

---

## Resources

- **Main Documentation**: `/docs/N4L.md`
- **Arrow Definitions**: `/SSTconfig/arrows-*.sst`
- **Examples**: `/examples/*.n4l`
- **text2n4l Guide**: `/docs/text2N4L.md`

---

_Happy editing! Remember: the best N4L files are iteratively refined, not perfect on the first pass._
